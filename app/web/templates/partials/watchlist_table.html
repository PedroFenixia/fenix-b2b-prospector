{% if total > 0 %}
<div class="flex items-center justify-between mb-3">
    <p class="text-sm text-gray-500">{{ total }} empresa{{ 's' if total != 1 else '' }} vigilada{{ 's' if total != 1 else '' }}</p>
</div>
<div class="space-y-3">
    {% for w in items %}
    <div class="card p-5 flex items-center justify-between gap-4 flex-wrap">
        <div class="flex-1 min-w-0">
            <a href="/companies/{{ w.company.id }}" class="text-sm font-semibold text-gray-900 hover:text-brand-500 transition truncate block">
                {{ w.company.nombre }}
            </a>
            <div class="flex items-center gap-2 mt-1 flex-wrap">
                {% if w.company.provincia %}
                <span class="text-xs text-gray-400">{{ w.company.provincia }}</span>
                {% endif %}
                {% if w.company.forma_juridica %}
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-brand-50 text-brand-600 border border-brand-100">{{ w.company.forma_juridica }}</span>
                {% endif %}
                {% if w.company.estado == 'activa' %}
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-50 text-green-600 border border-green-100">Activa</span>
                {% elif w.company.estado == 'disuelta' %}
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-red-50 text-red-600 border border-red-100">Disuelta</span>
                {% endif %}
            </div>
            {% if w.notas %}
            <p class="text-xs text-gray-400 mt-1.5">{{ w.notas }}</p>
            {% endif %}
        </div>
        <div class="flex items-center gap-2">
            <span class="text-[10px] text-gray-300 font-mono">{{ w.created_at.strftime('%d/%m/%Y') }}</span>
            <button onclick="removeFromWatchlist({{ w.company_id }})"
                    class="text-xs text-red-400 hover:text-red-600 font-medium transition">Eliminar</button>
        </div>
    </div>
    {% endfor %}
</div>

{% if pages > 1 %}
<div class="flex justify-center gap-2 mt-4">
    {% for p in range(1, pages + 1) %}
    {% if p == page %}
    <span class="px-3 py-1.5 bg-brand-500 text-white rounded-lg text-sm font-semibold">{{ p }}</span>
    {% else %}
    <button hx-get="/watchlist/list?page={{ p }}" hx-target="#watchlist-results"
            class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm text-gray-600 hover:border-brand-500 hover:text-brand-500 transition">{{ p }}</button>
    {% endif %}
    {% endfor %}
</div>
{% endif %}

{% else %}
<div class="text-center py-16">
    <p class="text-gray-400 text-sm">No tienes empresas en vigilancia.</p>
    <p class="text-gray-300 text-xs mt-1">Ve al detalle de una empresa y pulsa "Vigilar" para a&ntilde;adirla.</p>
</div>
{% endif %}

<script>
async function removeFromWatchlist(companyId) {
    if (!confirm('Eliminar empresa de la vigilancia?')) return;
    const resp = await fetch('/api/watchlist/' + companyId, { method: 'DELETE' });
    if (resp.ok) {
        htmx.trigger(document.body, 'htmx:load');
        location.reload();
    }
}
</script>
